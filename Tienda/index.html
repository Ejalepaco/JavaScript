<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulador de Tienda Online</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body { background-color: #f4f4f9; }
    h2, h3 { color: #333; }
    .card { border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform 0.2s; }
    .card:hover { transform: translateY(-5px); }
    .card-img-top { height: 200px; object-fit: contain; background-color: #fff; padding: 10px; }
    .card-title { font-size: 1.1rem; font-weight: bold; }
    .card-text { font-size: 0.9rem; height: 50px; overflow: hidden; }
    .btn-primary { width: 100%; }
    #carrito { max-height: 400px; overflow-y: auto; }
    #carrito .list-group-item { display: flex; justify-content: space-between; align-items: center; }
    #carrito .btn { margin-left: 10px; }
    .filtro-card { border-radius: 15px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; background-color: #fff; }
    #mensaje-cargando { font-style: italic; color: #555; }
    #total-carrito { font-size: 1.2rem; font-weight: bold; color: #007bff; }
  </style>
</head>
<body>

<div class="container mt-5">
  <div class="row">
    <!-- Zona de productos -->
    <div class="col-lg-8">
      <h2 class="text-center mb-4">Tienda Online</h2>

      <!-- Filtros -->
      <div class="filtro-card">
        <label for="filtro-categoria" class="form-label">Categoría</label>
        <select id="filtro-categoria" class="form-select mb-3" onchange="aplicarFiltro()">
          <option value="">Selecciona una categoría</option>
          <option value="electronics">Electrónica</option>
          <option value="jewelery">Joyería</option>
          <option value="men's clothing">Ropa de hombre</option>
          <option value="women's clothing">Ropa de mujer</option>
        </select>

        <label for="precio-minimo" class="form-label">Precio Mínimo</label>
        <input type="number" id="precio-minimo" class="form-control mb-3" placeholder="Precio mínimo" onchange="aplicarFiltro()" />

        <label for="precio-maximo" class="form-label">Precio Máximo</label>
        <input type="number" id="precio-maximo" class="form-control" placeholder="Precio máximo" onchange="aplicarFiltro()" />
      </div>

      <div id="mensaje-cargando" class="text-center mb-4">
        <p>Cargando productos...</p>
      </div>

      <div id="productos" class="row"></div>
    </div>

    <!-- Zona de carrito -->
    <div class="col-lg-4">
      <h3 class="mt-4">Carrito</h3>
      <div class="filtro-card">
        <ul id="carrito" class="list-group mb-3"></ul>
        <div>
          <strong>Total: </strong><span id="total-carrito">0€</span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
let productos = [];
let carrito = [];

async function cargarProductos() {
  const response = await fetch('https://fakestoreapi.com/products');
  const data = await response.json();
  productos = data;
  mostrarProductos(productos);
}

function mostrarProductos(productos) {
  const contenedorProductos = document.getElementById('productos');
  contenedorProductos.innerHTML = '';
  productos.forEach(producto => {
    const productoDiv = document.createElement('div');
    productoDiv.classList.add('col-md-4', 'mb-4');
    productoDiv.innerHTML = `
      <div class="card">
        <img src="${producto.image}" class="card-img-top" alt="${producto.title}">
        <div class="card-body">
          <h5 class="card-title">${producto.title}</h5>
          <p class="card-text">${producto.description}</p>
          <p><strong>Precio: </strong>${producto.price}€</p>
          <button class="btn btn-primary" onclick="agregarAlCarrito(${producto.id})">Agregar al carrito</button>
        </div>
      </div>
    `;
    contenedorProductos.appendChild(productoDiv);
  });
  document.getElementById('mensaje-cargando').style.display = 'none';
}

function agregarAlCarrito(idProducto) {
  const producto = productos.find(p => p.id === idProducto);
  if (producto) {
    carrito.push(producto);
    mostrarCarrito();

    Swal.fire({
      icon: 'success',
      title: '¡Agregado al carrito!',
      text: `${producto.title} ha sido añadido.`,
      timer: 1500,
      showConfirmButton: false,
      position: 'top-end',
      toast: true
    });
  }
}

function mostrarCarrito() {
  const carritoDiv = document.getElementById('carrito');
  carritoDiv.innerHTML = '';
  carrito.forEach((producto, index) => {
    const productoCarrito = document.createElement('li');
    productoCarrito.classList.add('list-group-item');
    productoCarrito.innerHTML = `
      ${producto.title} - ${producto.price}€
      <button class="btn btn-danger btn-sm" onclick="eliminarDelCarrito(${index})">Eliminar</button>
    `;
    carritoDiv.appendChild(productoCarrito);
  });
  actualizarTotalCarrito();
}

function eliminarDelCarrito(index) {
  const producto = carrito[index];

  Swal.fire({
    title: '¿Eliminar producto?',
    text: `${producto.title} será eliminado del carrito.`,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Sí, eliminar',
    cancelButtonText: 'Cancelar'
  }).then((result) => {
    if (result.isConfirmed) {
      carrito.splice(index, 1);
      mostrarCarrito();
      Swal.fire({
        icon: 'success',
        title: 'Eliminado',
        text: `${producto.title} ha sido eliminado del carrito.`,
        timer: 1200,
        showConfirmButton: false,
        toast: true,
        position: 'top-end'
      });
    }
  });
}

function actualizarTotalCarrito() {
  const total = carrito.reduce((sum, producto) => sum + producto.price, 0);
  document.getElementById('total-carrito').textContent = `${total.toFixed(2)}€`;
}

function aplicarFiltro() {
  const categoria = document.getElementById('filtro-categoria').value;
  const precioMinimo = parseFloat(document.getElementById('precio-minimo').value) || 0;
  const precioMaximo = parseFloat(document.getElementById('precio-maximo').value) || Infinity;
  let productosFiltrados = productos;

  if (categoria) productosFiltrados = productosFiltrados.filter(p => p.category.toLowerCase() === categoria.toLowerCase());
  if (precioMinimo > 0) productosFiltrados = productosFiltrados.filter(p => p.price >= precioMinimo);
  if (precioMaximo < Infinity) productosFiltrados = productosFiltrados.filter(p => p.price <= precioMaximo);

  mostrarProductos(productosFiltrados);
}

cargarProductos();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
